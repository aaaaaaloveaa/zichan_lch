<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../layuiadmin/layui/css/layui.css">
    <link rel="stylesheet" href="../../css/font-awesome/css/font-awesome.css" media="all" />
		<!-- <link rel="stylesheet" href="../../css/mui.min.css"> -->
		<style>
			.layui-form-item{
				margin:0
			}
			.bcbtn{
				width:100%;
				margin-top:20px
			}
			.demoTable{
				position: fixed;
				left: 0%;
				bottom: 0px;
				width:100%;
				height:40px
			}
			.demoTable-btn{
				width:100%;
				height:40px;
				float: left;
			}	
		</style>
</head>
<body>
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
<!-- 	<div class="form-actions">
		<div class="row">
			<div class="col-md-12">
                <button class="layui-btn" type="submit" onclick="add()"><i class="fa fa-save"></i> 保存</button>
			</div>
		</div>
	</div> -->
<!-- <hr style="height:3px;"> -->
	<form class="layui-form layui-form-pane form-horizontal" onsubmit="return false" id="form">
			<input type="hidden" id="id" name="id">
			<input type="hidden" id="deptid" name="deptid">
			<div class='layui-form-item'>
				<div class='layui-inline'>
					<label class='layui-form-label'>用户名</label>
					<div class='layui-input-inline'>
						<input class='layui-input' placeholder='用户名' type='text' name='username' id='username' lay-verify='required'>
					</div>
				</div>
			</div>
			<div class='layui-form-item'>
				<div class='layui-inline'>
					<label class='layui-form-label'>密码</label>
					<div class='layui-input-inline'>
						<input class='layui-input' placeholder='密码' type='text' name='password' id='password' lay-verify='required' value="123456">
					</div>
				</div>
			</div>
			<div class='layui-form-item'>
				<div class='layui-inline'>
					<label class='layui-form-label'>姓名</label>
					<div class='layui-input-inline'>
						<input class='layui-input' placeholder='姓名' type='text' name='nickname' id='nickname' >
					</div>
				</div>
			</div>
			<div class='layui-form-item'>
				<div class='layui-inline'>
					<label class='layui-form-label'>电话</label>
					<div class='layui-input-inline'>
						<input class='layui-input' placeholder='电话' type='text' name='phone' id='phone' >
					</div>
				</div>
			</div>
			
			<div class='layui-form-item'>
				<div class='layui-inline'>
					<label class='layui-form-label'>邮箱</label>
					<div class='layui-input-inline'>
						<input class='layui-input' placeholder='邮箱' type='text' name='email' id='email' >
					</div>
				</div>
			</div>
			<div class='layui-form-item'>
				<div class='layui-inline'>
					<label class='layui-form-label'>生日</label>
					<div class='layui-input-inline'>
						<input class='layui-input' placeholder='生日' type='text' name='birthday' id='birthday' >
					</div>
				</div>
			</div>
			<div class='layui-form-item'>
				<div class='layui-inline'>
					<label class='layui-form-label'>性别</label>
					<div class='layui-input-inline'>
						<select class="form-control input-sm" name="sex" id="sex"></select>
					</div>
				</div>
			</div>
			<!-- <div class='layui-form-item'>
				<div class='layui-inline'>
					<label class='layui-form-label'>部门</label>
					<div class='layui-input-inline'>
						<select class="form-control input-sm" name="deptid" id="deptid"></select>
					</div>
				</div>
			</div> -->
			
			<div class='layui-form-item'>
				<div class='layui-inline'>
					<label class='layui-form-label'>入职时间</label>
					<div class='layui-input-inline'>
						<input class='layui-input' placeholder='入职时间' type='text' name='rzsj' id='rzsj' >
					</div>
				</div>
			</div>
		<!-- 	<div class='layui-form-item'>
				<div class='layui-inline'>
					<label class='layui-form-label'>专业特长</label>
					<div class='layui-input-inline'>
						<input class='layui-input' placeholder='专业特长' type='text' name='zytc' id='zytc' >
					</div>
				</div>
			</div> -->
			<div class='layui-form-item'>
				<div class='layui-inline'>
					<label class='layui-form-label'>工人等级</label>
					<div class='layui-input-inline'>
						<select class="form-control input-sm" name="ctype" id="ctype"></select>
					</div>
				</div>
			</div>
			
			<div class='layui-form-item'>
				<div class='layui-inline'>
					<label class='layui-form-label'>备注</label>
					<div class='layui-input-inline'>
						<input class='layui-input' placeholder='备注' type='text' name='memo' id='memo' >
					</div>
				</div>
			</div>
<br/><br/>
	</form>
</div>


<div class="demoTable">
		<button class="layui-btn layui-btn-normal demoTable-btn"  onclick="add()">
				保存
		</button>
</div>
	<script src="../../js/mui.min.js"></script>
	<script type="text/javascript" src="../../js/properties.js" ></script>
	<script type="text/javascript" src="../../js/jquery.min.js"></script>
	<script type="text/javascript" src="../../js/jq.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script type="text/javascript" src="../../layuiadmin/layui/layui.js"></script>
	<script type="text/javascript" src="../../js/dict.js"></script>
	<script type="text/javascript" src="../../js/dept.js"></script>
	<script type="text/javascript" src="../../js/gongzibz.js"></script>	
	<script type="text/javascript">
		layui.use(['layer','form','laydate'], function(){
		    var layer = layui.layer;
        var form = layui.form;
				var laydate = layui.laydate;
				laydate.render({
				   elem: '#birthday'
				});
				laydate.render({
				   elem: '#rzsj'
				});
		});
	  
    var token = JSON.parse(localStorage.getItem('$state')).token;
			var self = null;
			var id;
			mui.plusReady(function() {
					self = plus.webview.currentWebview();
					id = self.userid;
					// initRoles();
					initData(id);
					mui.init({
							beforeback: function() {
								self.close();
							}
					});
			});
			
			showDeptSelect("deptid","dept",true);
			
			showDictSelect("sex", "sex");
showGongzibzSelect("ctype","gongzibz",true);

		function initData(id){
			if(id){
				$.ajax({
					type : 'get',
					url : server_url+'/users/'+id,
					async : false,
					success : function(data) {
						
						$("#id").val(data.id);
						$("#username").val(data.username);
						$("#nickname").val(data.nickname);
		                $("#deptid").val(data.deptid);
		                $("#positionid").val(data.positionid);
						$("#phone").val(data.phone);
						$("#telephone").val(data.telephone);
						$("#email").val(data.email);
						$("#birthday").val(data.birthday);
						$("#sex").val(data.sex);
						$("#ctype").val(data.ctype);
						$("#rzsj").val(data.rzsj);
						$("#zytc").val(data.zytc);
						$("#yuexin").val(data.yuexin);
						$("#memo").val(data.memo);
						renderForm();       //重新渲染表单
					}
				});
				
				// initRoleDatas(id);
			}
		}
		
		function add() {

		    var formdata = $("#form").serializeObject();
			var posttype="post";
			if (id){ posttype="put"; }
			alert(JSON.stringify(formdata));
			$.ajax({
				type : posttype ,
				url : server_url+'/users',
				contentType: "application/json; charset=utf-8",  
				data : JSON.stringify(formdata),
				headers:{'token':token},
				success : function(data) {
						mui.plusReady(function() {
                			var clist = plus.webview.getWebviewById("sysUserList.html");
                			mui.fire(clist, 'refresh');
                				layer.msg("保存成功", {shift: -1, time: 1000}, function(){
                					self.close();
                				});
                		})
				}
			});
		}
		
	</script>
</body>
</html>
