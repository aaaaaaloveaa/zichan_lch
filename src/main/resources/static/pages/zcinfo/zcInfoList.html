<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>表单列表</title>
    <link rel="stylesheet" href="../../layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../../layuiadmin/eleTree/eleTree.css" media="all">
    <style>
        .eleTree {
            width: 350px;
            height: 500px;
            border: 1px solid #ccc;
            overflow: hidden;
            display: inline-block;
        }

        .ele5 {
            height: auto;
            width: 98%;
            display: none;
            position: absolute;
            top: 100%;
            background-color: #fff;
            z-index: 9999999999999;
        }
        .layui-form-select .layui-input {
            padding-right: 0px!important;
        }
        #gdImportBt{
            margin-left: 0px!important;
        }
    </style>
    <script src="../../js/UHF.js"></script>
</head>
<body>

<div class="layui-fluid" style="margin-top:15px">
    <!--	<div class="layui-col-space15" style="height:100%;">-->
    <!--		&lt;!&ndash;资产类别&ndash;&gt;-->
    <!--		<div class="layui-col-md3" style="height:100%;" id="zcCategoryTree">-->
    <!--			<div class="layui-card" style="height:100%;">-->
    <!--				<div class="layui-card-header">资产类别</div>-->
    <!--				<div class="layui-card-body">-->
    <!--					&lt;!&ndash;<div class="layui-carousel layadmin-carousel layadmin-dataview" data-anim="fade" lay-filter="LAY-index-normcol">&ndash;&gt;-->
    <!--					<div id="eleTree" lay-filter="eleTree"></div>-->
    <!--					&lt;!&ndash;</div>&ndash;&gt;-->
    <!--				</div>-->
    <!--			</div>-->
    <!--		</div>-->
    <!--		<div class="layui-col-md9" style="height:100%">-->
    <div class="layui-card">
        <div class="layui-card-header">资产查询</div>
        <div class="layui-form layui-card-header layuiadmin-card-header-auto" style="height:300px">
            <div class="layui-form-item">
                <form class="form-inline layui-inline" style="margin-top:15px" id="form" method="post"
                      action="/zcInfos/export" onsubmit="return false" enctype="multipart/form-data">
                    <input id="token" name="token" type="hidden"/>


                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">资产追溯码</label>
                            <div class="layui-input-block">
                                <input id="epcid" name="epcid" type="text" class="layui-input" placeholder="资产追溯码">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">资产名称</label>
                            <div class="layui-input-block">
                                <input id="zcName" name="zcName" type="text" class="layui-input" placeholder="资产名称">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">资产编码</label>
                            <div class="layui-input-block">
                                <input id="zcCodenum" name="zcCodenum" type="text" class="layui-input" placeholder="资产编码">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">分类</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text" id="zcCategoryName" data-id=""
                                       placeholder="请选择资产分类" readonly="" autocomplete="off">
                                <div class="eleTree ele5" id="zcCategoryEleTree" lay-filter="zcCategoryEleTree"></div>
                                <input class="layui-input" type="hidden" id="catCode" name="catCode">
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">规格</label>
                            <div class="layui-input-block">
                                <input id="specification" name="specification" type="text" class="layui-input" placeholder="规格">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">型号</label>
                            <div class="layui-input-block">
                                <input id="model" name="model" type="text" class="layui-input" placeholder="型号">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="" style="float:left;text-align: right">开始使用日期</label>
                            <div class="layui-input-block">
                                <input id="sdate" name="sdate" type="text" class="form-control layui-input"
                                       placeholder="起始日期">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">至</label>
                            <div class="layui-input-block">
                                <input id="edate" name="edate" type="text" class="form-control layui-input"
                                       placeholder="终止日期">
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">使用状态</label>
                            <div class="layui-input-block">
                                <select id="useStatus" name="useStatus" class="form-control layui-input"></select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">管理部门</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text" id="glDeptName" data-id="" placeholder="请选择管理部门"
                                       readonly="" autocomplete="off">
                                <div class="eleTree ele5" id="glDeptEleTree" lay-filter="glDeptEleTree"></div>
                                <input class="layui-input" type="hidden" id="glDeptId" name="glDeptId">
                            </div>
                        </div>

                        <div class="layui-inline">
                            <label class="layui-form-label">使用部门</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text" id="syDeptName" data-id="" placeholder="请选使用部门"
                                       readonly="" autocomplete="off">
                                <div class="eleTree ele5" id="syDeptEleTree" lay-filter="syDeptEleTree"></div>
                                <input class="layui-input" type="hidden" id="syDeptId" name="syDeptId">
                            </div>
                        </div>


                        <div class="layui-inline">
                            <label class="layui-form-label">原价值</label>
                            <div class="layui-input-block">
                                <input id="originalValue" name="originalValue" type="text" class="layui-input"
                                       placeholder="原价值">
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">净值</label>
                            <div class="layui-input-block">
                                <input id="netvalue" name="netvalue" type="text" class="layui-input"
                                       placeholder="净值">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">使用月限</label>
                            <div class="layui-input-block">
                                <input id="useMonths" name="useMonths" type="text" class="layui-input"
                                       placeholder="使用月限">
                            </div>
                        </div>
                        <!--<div class="layui-inline">-->
                            <!--<label class="layui-form-label">剩余期限</label>-->
                            <!--<div class="layui-input-block">-->
                                <!--<input id="remainingperiod" name="remainingperiod" type="text" class="layui-input"-->
                                       <!--placeholder="剩余期限">-->
                            <!--</div>-->
                        <!--</div>-->
                        <div class="layui-inline">
                            <label class="layui-form-label">创建日期</label>
                            <div class="layui-input-block">
                                <input id="createTime" name="createTime" type="text" class="form-control layui-input"
                                       placeholder="创建日期">
                            </div>
                        </div>
                        <button type="button" class="layui-btn layuiadmin-btn-useradmin" lay-submit
                                lay-filter="LAY-user-front-search" id="searchBt">
                            <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                        </button>
                        <button type="reset" class="layui-btn layuiadmin-btn-useradmin" lay-submit
                                lay-filter="LAY-user-front-search" >
                            <i class="layui-icon layui-icon-refresh-3 layuiadmin-button-btn"></i>
                        </button>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-inline">

                            <button class="layui-btn layuiadmin-btn-useradmin" data-type="add"
                                    onclick="location.href='addZcInfo.html'" id="addBtn">添加
                            </button>
                            <button class="layui-btn layuiadmin-btn-useradmin" id="gdImportBt">固定资产导入</button>
                            <button class="layui-btn layuiadmin-btn-useradmin" id="dzImportBt">低值易耗品导入</button>
                            <button class="layui-btn layuiadmin-btn-useradmin" id="exportBt">导出</button>
<!--                            <button class="layui-btn layuiadmin-btn-useradmin" id="gjseachBt">高级查询</button>-->
                        </div>
                        <div class="layui-inline">
                            <div id="msg"></div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="layui-card-body">
            <table class="layui-hide" id="data" lay-filter="data"></table>
        </div>
    </div>
    <!--		</div>-->
    <!--	</div>-->
</div>
</body>
</html>

<script type="text/javascript" src="../../js/libs/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script type="text/javascript" src="../../layuiadmin/layui/layui.js"></script>
<script type="text/javascript" src="../../js/my/permission.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript" src="../../js/UHF.js"></script>
<script type="text/javascript" src="../../js/dict.js"></script>
<script type="text/javascript">
    var pers = checkPermission();
    var useStatus = showDictSelect("useStatus","useStatus",false)
    var status = 0;
    if ($.inArray("sys:zcInfo:import", pers) < 0) {
        $("#gdImportBt").hide();
        $("#dzImportBt").hide();
    }
    if ($.inArray("sys:zcInfo:export", pers) < 0) {
        $("#exportBt").hide();
    }
    if ($.inArray("sys:zcInfo:add", pers) < 0) {
        $("#addBtn").hide();
    }
    debugger
    if ($.inArray("sys:zcinfo:card", pers) > 0) {
        status = 1;
    }

    var tableIns;

    layui.config({
        base: '../../layuiadmin/' //设定扩展的Layui模块的所在目录，一般用于外部模块扩展
    }).extend({
        eleTree: 'eleTree/eleTree',
        dynamicCondition: 'dynamicCondition/dynamicCondition',

    })
    var el, el1, el2;
    var catCode
    layui.use(['layer', 'form', 'laydate', 'table', 'upload', 'eleTree', 'dynamicCondition'], function () {

        var layer = layui.layer;
        var form = layui.form;
        var laydate = layui.laydate;
        laydate.render({
            elem: '#sdate'
        });
        laydate.render({
            elem: '#edate'
        });
        laydate.render({
            elem: '#createTime'
        });
        var upload = layui.upload;
        var dynamicCondition = layui.dynamicCondition;
        var dataFields = [
            {field: 'epcid', title: '资产追溯码', edit: "text"}
            ,{field:'zc_name', title:'资产名称', edit:"text"}
            // , {field: 'card_num', title: '卡片编号', edit: "text"}
            , {field: 'zc_codenum', title: '资产编码', edit: "text"}
            , {field: 'specification', title: '规格', edit: "text"}
            , {field: 'model', title: '型号', edit: "text"}
            , {field: 'unit', title: '单位', edit: "text"}
            , {field: 'use_status', title: '使用状态', edit: "select_use_status", templet: "#selectUseStatus"}
            , {field: 'sy_name', title: '使用人', edit: "text"}
            , {field: 'store_address', title: '存放地点', edit: "text"}
            , {field: 'maintain_cycle', title: '维护周期/天', edit: "text"}
            , {field: 'zc_from', title: '资产来源', edit: "text"}
            , {field: 'original_value', title: '原价值', edit: "text"}
            , {field: 'lj_zhejiu', title: '累计折旧', edit: "text"}
            , {field: 'bn_zhejiu', title: '本年折旧', edit: "text"}
            , {field: 'netvalue', title: '净值', width: 100, sort: true}
            , {field: 'jzzb', title: '减值准备', width: 100, sort: true}
            , {field: 'net', title: '净额', edit: "text"}
            , {field: 'net_residual_rate', title: '净残值率', edit: "text"}
            , {field: 'net_residual_value', title: '净残值', edit: "text"}
            , {field: 'start_use_time', title: '开始使用日期', edit: "date"}
            , {field: 'use_months', title: '使用月限', edit: "text"}
            , {field: 'have_count', title: '已计提期数', edit: "text"}
            , {field: 'remainingperiod', title: '剩余期限', edit: "text"}
            , {field: 'cname', title: '服务商名称', edit: "text"}
            , {field: 'venperson', title: '联系人', edit: "text"}
            , {field: 'venphone', title: '联系方式', edit: "text"}
            , {field: 'venaddress', title: '服务商地址', edit: "text"}
            , {field: 'warrantyperiod', title: '保修期限', edit: "text"}
            , {field: 'epcid', title: '标签卡编号', edit: "text"}
            , {field: 'create_time', title: '创建时间', edit: "date"}
        ];
        //初始化动态条件查询实例
        var dcInstance = dynamicCondition.create({
            fields: dataFields //通过json对象传入
            //,tableId:"listTable"  //静态页面不好演示table数据表格更新
            , type: "complex"  //type:"simple"/"complex"
            , conditionTextId: "#msg"
            , queryCallBack: function (requestData) {
                tableIns.reload({where: requestData, page: {curr: 1}})
            }
        });
        /**高级查询*/
        $("#gjseachBt").on("click", function () {
            dcInstance.open();
        })


        /**
         * 查询使用状态的高级查询
         */
        var editorCity = dynamicCondition.createEditor("select_use_status");
        $.extend(editorCity, {
            createElement: function (item) {
                var selJq = $("<select>");
                // selJq.append("<option value=''></option>");
                if (useStatus){
                    $.each(useStatus, function(k, v) {
                        selJq.append("<option value ='" + k + "'>" + v + "</option>");
                    });
                }
                return selJq;
            }
            , getRequestText: function (ele) {
                return ele.find("option:selected").text();
            }
        })

        var eleTree = layui.eleTree;
        var table = layui.table;
        tableIns = table.render({
            elem: '#data',
            url: "/zcInfos/layuiList",
            limit: 20,
            limits: [20, 40, 50, 100, 200, 500, 1000, 2000],
            totalRow: true,
            toolbar: 'defaultX',
            height: 'full-200',
            even: true , //开启隔行背景
            size: 'sm' ,//小尺寸的表格
            autoSort: false,
            where: {
                epcid:$('#epcid').val(),
                zcName: $('#zcName').val(),
                zcCodenum: $('#zcCodenum').val(),
                sdate: $('#sdate').val(),
                edate: $('#edate').val(),
                catCode: $('#catCode').val(),
                glDeptId: $('#glDeptId').val(),
                specification: $('#specification').val(),
                model:$('#model').val(),
                useStatus: $('#useStatus').val(),
                originalValue: $('#originalValue').val(),
                netvalue: $('#netvalue').val(),
                useMonths: $('#useMonths').val(),
                remainingperiod: $('#remainingperiod').val()
            }
            ,
            page: true
            ,
            request: {
                pageName: 'offset' //页码的参数名称，默认：page
            }
            ,
            cols: [[
                {field: 'id', hide: true}
                // ,{field:'selfCodenum',title:'同资产编码', width:100, sort: true}
                , {field: 'epcid', title: '资产追溯码', width: 130, sort: true}
                // , {field: 'cardNum', title: '卡片编号', width: 100, sort: true}
                , {field: 'zcCodenum', title: '资产编码', width: 130, sort: true}
                , {field: 'zcName', title: '资产名称', width: 130, sort: true}
                , {field: 'zcCategoryYiJi', title: '资产1级分类', width: 120}
                , {field: 'zcCategoryErJi', title: '资产2级分类', width: 120}
                , {field: 'zcCategoryName', title: '资产3级分类', width: 120, sort: true}
                , {field: 'specification', title: '规格', width: 100, sort: true}
                , {field: 'model', title: '型号', width: 100, sort: true}
                , {field: 'useStatusName', title: '使用状态', width: 100, sort: true}
                , {field: 'glDeptName', title: '管理部门', width: 150, sort: true}
                , {field: 'unit', title: '单位', width: 100, sort: true}
                , {field: 'syDeptName', title: '使用部门', width: 150, sort: true}
                , {field: 'syName', title: '使用人', width: 100, sort: true}
                , {field: 'storeAddress', title: '存放地点', width: 100, sort: true}
                , {field: 'maintainCycle', title: '维护周期/天', width: 100, sort: true}
                , {field: 'zcFrom', title: '资产来源', width: 100, sort: true}
                , {field: 'originalValue', title: '原价值', width: 100, sort: true}
                , {field: 'ljZhejiu', title: '累计折旧', width: 100, sort: true}
                , {field: 'bnZhejiu', title: '本年折旧', width: 100, sort: true}
                , {field: 'netvalue', title: '净值', width: 100, sort: true}
                , {field: 'jzzb', title: '减值准备', width: 100, sort: true}
                , {field: 'net', title: '净额', width: 100, sort: true}
                , {field: 'netResidualRate', title: '净残值率', width: 100, sort: true}
                , {field: 'netResidualValue', title: '净残值', width: 100, sort: true}
                , {field: 'startUseTime', title: '开始使用日期', width: 110, sort: true}
                , {field: 'useMonths', title: '使用月限', width: 100, sort: true}
                , {field: 'haveCount', title: '已计提期数', width: 100, sort: true}
                , {field: 'remainingperiod', title: '剩余期限', width: 100, sort: true}
                , {field: 'cname', title: '服务商名称', width: 100, sort: true}
                , {field: 'venperson', title: '联系人', width: 100, sort: true}
                , {field: 'venphone', title: '联系方式', width: 100, sort: true}
                , {field: 'venaddress', title: '服务商地址', width: 100, sort: true}
                , {field: 'warrantyperiod', title: '保修期限', width: 100, sort: true}
                , {field: 'creator', title: '创建人', width: 100, sort: true}
                , {field: 'createTime', title: '创建时间', width: 150, sort: true}
                , {field: 'bz', title: '备注', width: 100, sort: true}

                // ,{field:'factory',title:'厂家', width:100, sort: true}
                // ,{field:'brand',title:'品牌', width:100, sort: true}
                // ,{field:'supportName',title:'技术支持人员', width:100, sort: true}
                // ,{field:'supportPhone',title:'技术支持电话', width:100, sort: true}
                // ,{field:'installationFactory',title:'安装单位', width:100, sort: true}
                // ,{field:'depreciationTime',title:'折旧年限(月份)', width:100, sort: true}
                // ,{field:'jcz',title:'净参值(5%)', width:100, sort: true}
                // ,{field:'stockTime',title:'采购日期', width:100, sort: true}
                // ,{field:'accountentryStatus',title:'入账状态', width:100, sort: true}
                // ,{field:'accountentryTime',title:'入账日期', width:100, sort: true}
                // ,{field:'accountantNum',title:'会计凭证号', width:100, sort: true}
                // ,{field:'cardStatus',title:'发卡状态', width:100, sort: true}
                // ,{field:'cardTime',title:'发卡日期', width:100, sort: true}
                // ,{field:'responsible',title:'责任人(填写)', width:100, sort: true}
                // ,{field:'predictYears',title:'预计使用年限', width:100, sort: true}
                // ,{field:'laveTime',title:'剩余期限', width:100, sort: true}
                // ,{field:'maintainDeadline',title:'临保时间', width:100, sort: true}
                // ,{field:'lastMaintainTime',title:'保养日期', width:100, sort: true}
                // ,{field:'bf',title:'是否报废  0:未报废 1:已报废', width:100, sort: true}

                , {
                    field: 'caozuo', title: '操作',align:'center', fixed: 'right', width: 150, templet: function (d) {
                        var id = d.id;
                        var href = "updateZcInfo.html?id=" + id;
                        var edit = buttonEdit(href, "sys:zcInfo:edit", pers);
                        var del = buttonDel(id, "sys:zcInfo:del", pers);
                        var card = "";
                        // if (status == 1) {
                        //     card = "<button class='layui-btn layui-btn-xs' title='发卡' lay-event='card'>发卡</button>"
                        // }
                        return edit + del + card;
                    }
                }
            ]]
        });

        //监听排序事件
        table.on('sort(data)', function (obj) { //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
            if (!obj.type) return;
            tableIns.reload({
                initSort: obj //记录初始排序，如果不设的话，将无法标记表头的排序状态。
                , where: { //请求参数（注意：这里面的参数可任意定义，并非下面固定的格式）
                    epcid:$('#epcid').val(),
                    zcName: $('#zcName').val(),
                    zcCodenum: $('#zcCodenum').val(),
                    sdate: $('#sdate').val(),
                    edate: $('#edate').val(),
                    catCode: $('#catCode').val(),
                    glDeptId: $('#glDeptId').val(),
                    specification: $('#specification').val(),
                    model:$('#model').val(),
                    useStatus: $('#useStatus').val(),
                    originalValue: $('#originalValue').val(),
                    netvalue: $('#netvalue').val(),
                    useMonths: $('#useMonths').val(),
                    remainingperiod: $('#remainingperiod').val(),
                    orderBy: "order by " + obj.field + " " + obj.type//排序字段 + 排序方式
                }
                , page: {curr: 1}
            });
        });

        //监听工具条
        table.on('tool(data)', function (obj) {
            var data = obj.data;
            if (obj.event === 'card') {
               if (data.cardStatus==1){
                   layer.confirm('该资产已发卡，是否重新发卡', {
                       btn: ['确定','取消'] //按钮
                   }, function(index, layero){
                       layer.close(index);
                       layer.open({
                           type: 2
                           , title: '发卡'
                           , content: encodeURI('cardZcInfo.html?id=' + data.id)
                           , area: ['80%', '80%']
                           ,success: function(layero, index){
                               openCom();
                           },
                           end: function () {
                               closeCom();
                           }
                       });
                   });
               }
            }
        });

        //执行实例
        var uploadInst = upload.render({
            elem: '#gdImportBt' //绑定元素
            , url: '/zcInfos/gudingImport' //上传接口
            , accept: 'file'
            , done: function (res) {
                if (res.code == 1) {
                    layer.msg(res.msg);
                }
                //上传完毕回调
                if (res.code == 0) {
                    layer.msg("上传并导入成功");
                    $('#searchBt').trigger('click');
                }
                if (res.code == -1) {
                    layer.msg("数据导入失败：" + res.msg);
                }
            }
            , error: function () {
                //请求异常回调
                layer.msg("数据导入失败");
            }
        });

        var uploadInst1 = upload.render({
            elem: '#dzImportBt' //绑定元素
            , url: '/zcInfos/dizhiImport' //上传接口
            , accept: 'file'
            , done: function (res) {
                if (res.code == 1) {
                    layer.msg(res.msg);
                }
                //上传完毕回调
                if (res.code == 0) {
                    layer.msg("上传并导入成功");
                    $('#searchBt').trigger('click');
                }
                if (res.code == -1) {
                    layer.msg("数据导入失败：" + res.msg);
                }
            }
            , error: function () {
                //请求异常回调
                layer.msg("数据导入失败");
            }
        });

        if (!el) {
            el = eleTree.render({
                elem: '#zcCategoryEleTree',
                url: '/zcCategorys/eleTree',
                request: {
                    name: "name",
                },
                emptText: "暂无资产分类",
                // defaultExpandAll: true,
                expandOnClickNode: false,
                highlightCurrent: true,
                done: function (res) {

                }
            });
        }
        if (!el1) {
            el1 = eleTree.render({
                elem: '#glDeptEleTree',
                url: '/depts/eleTreeSelf',
                request: {
                    name: "name",
                },
                emptText: "暂无管理部门",
                // defaultExpandAll: true,
                expandOnClickNode: false,
                highlightCurrent: true,
                done: function (res) {

                }
            });
        }
        if (!el2) {
            el2 = eleTree.render({
                elem: '#syDeptEleTree',
                url: '/depts/xmSelectTree',
                request: {
                    name: "name",
                },
                emptText: "暂无使用部门",
                // defaultExpandAll: true,
                expandOnClickNode: false,
                highlightCurrent: true,
                done: function (res) {

                }
            });
        }
        $("#zcCategoryName").on("click", function (e) {
            e.stopPropagation();
            $(this).next(".eleTree").toggle();
        })
        eleTree.on("nodeClick(zcCategoryEleTree)", function (d) {
            $('#zcCategoryName').trigger('change');
            $("#zcCategoryName").val(d.data.currentData.name)
            // $("#zcCategoryId").val(d.data.currentData.id);
            $("#catCode").val(d.data.currentData.catCode);
            $(".eleTree").hide();
        })
        $("#glDeptName").on("click", function (e) {
            e.stopPropagation();
            $(this).next(".eleTree").toggle();
        })
        eleTree.on("nodeClick(glDeptEleTree)", function (d) {
            $('#glDeptName').trigger('change');
            $("#glDeptName").val(d.data.currentData.name)
            $("#glDeptId").val(d.data.currentData.id);
            $(".eleTree").hide();
        })
        $("#syDeptName").on("click", function (e) {
            e.stopPropagation();
            $(this).next(".eleTree").toggle();
        })
        eleTree.on("nodeClick(syDeptEleTree)", function (d) {
            $('#syDeptName').trigger('change');
            $("#syDeptName").val(d.data.currentData.name)
            $("#syDeptId").val(d.data.currentData.id);
            $(".eleTree").hide();
        })
        $(document).on("click", function () {
            $(".eleTree").hide();
        })
    });

    function del(id) {
        layer.confirm('确定要删除吗？', {
            btn: ['确定', '取消']
        }, function () {
            $.ajax({
                type: 'delete',
                url: '/zcInfos/' + id,
                success: function (data) {
                    $('#searchBt').trigger('click');
                    layer.msg("删除成功");
                }
            });

            layer.close(1);
        });
    }

    $("#searchBt").click(function () {
        debugger
        var glDeptId = $('#glDeptId').val();
        var syDeptId = $('#syDeptId').val();
        var glName = $('#glDeptName').val();
        var syName = $('#syDeptName').val();
        if (glName == null || glName == '') {
            glDeptId = "";
        }
        if (syName == null || syName == '') {
            syDeptId = "";
        }
        tableIns.reload({
            where: {
                epcid:$('#epcid').val(),
                zcName: $('#zcName').val(),
                zcCodenum: $('#zcCodenum').val(),
                sdate: $('#sdate').val(),
                edate: $('#edate').val(),
                catCode: $('#catCode').val(),
                glDeptId: glDeptId,
                syDeptId: syDeptId,
                specification: $('#specification').val(),
                model:$('#model').val(),
                useStatus: $('#useStatus').val(),
                originalValue: $('#originalValue').val(),
                netvalue: $('#netvalue').val(),
                useMonths: $('#useMonths').val(),
                remainingperiod: $('#remainingperiod').val(),
                createTime:$('#createTime').val()
            }, page: {curr: 1}
        })
    });

    //导出
    $("#exportBt").click(function () {
        $("#token").val(localStorage.getItem("token"))
        $("#form").attr("onsubmit", "return true");
        $("#form").submit();
        $("#form").attr("onsubmit", "return false");
    });
</script>
